specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # --- Legacy Mech (LM) Factories ---
  - kind: ethereum/contract
    name: LMFactory
    network: xdai
    source:
      address: "0x88de734655184a09b70700ae4f72364d1ad23728"
      abi: Factory
      startBlock: 27911512
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wassm/assemblyscript
      entities: [LegacyMech]
      abis:
        - name: Factory
          file: ../../abis/AgentFactory-LM.json
      file: ./src/mapping.ts
      eventHandlers:
        - event: CreateMech(indexed address,indexed uint256,indexed uint256)
          handler: handleCreateMechLM

  - kind: ethereum/contract
    name: LMFactory2
    network: xdai
    source:
      address: "0x4be7a91e67be963806fefa9c1fd6c53dfc358d94"
      abi: Factory
      startBlock: 30662989
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wassm/assemblyscript
      entities: [LegacyMech]
      abis:
        - name: Factory
          file: ../../abis/AgentFactory-LM.json
      file: ./src/mapping.ts
      eventHandlers:
        - event: CreateMech(indexed address,indexed uint256,indexed uint256)
          handler: handleCreateMechLM
  
  # --- Legacy Market-Maker (LMM) Factories ---
  - kind: ethereum/contract
    name: LMMFactory
    network: xdai
    source:
      address: "0x2acd313b892c9922e470e4950e907d5eaa70fc2a"
      abi: Factory
      startBlock: 35714019
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wassm/assemblyscript
      entities: [LegacyMechMarketPlace]
      abis:
        - name: Factory
          file: ../../abis/AgentFactory-LMM.json
      file: ./src/mapping.ts
      eventHandlers:
        - event: CreateMech(indexed address,indexed uint256,indexed uint256)
          handler: handleCreateMechLMM

  - kind: ethereum/contract
    name: LMMFactory2
    network: xdai
    source:
      address: "0x6d8cbebcad7397c63347d44448147db05e7d17b0"
      abi: Factory
      startBlock: 36582492
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wassm/assemblyscript
      entities: [LegacyMechMarketPlace]
      abis:
        - name: Factory
          file: ../../abis/AgentFactory-LMM.json
      file: ./src/mapping.ts
      eventHandlers:
        - event: CreateMech(indexed address,indexed uint256,indexed uint256)
          handler: handleCreateMechLMM

  - kind: ethereum/contract
    name: LMMFactory3
    network: xdai
    source:
      address: "0x25c980328762a03f70c2649ef4be691b811b690a"
      abi: Factory
      startBlock: 36582492
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wassm/assemblyscript
      entities: [LegacyMechMarketPlace]
      abis:
        - name: Factory
          file: ../../abis/AgentFactory-LMM.json
      file: ./src/mapping.ts
      eventHandlers:
        - event: CreateMech(indexed address,indexed uint256,indexed uint256)
          handler: handleCreateMechLMM

  # --- Legacy Marketplace Contract ---
  - kind: ethereum/contract
    name: LegacyMarketPlace
    network: xdai
    source:
      address: "0x4554fE75c1f5576c1d7F765B2A036c199Adae329"
      abi: LegacyMarketPlace
      startBlock: 35714019
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities: [LegacyMechMarketPlace, DailyFees]
      abis:
        - name: LegacyMarketPlace
          file: ../../abis/LegacyMarketPlace.json
      file: ./src/mapping.ts
      callHandlers:
        - function: request(bytes,address,address,uint256,address,uint256,uint256)
          handler: handleRequestFromMarketPlace

templates:
  - name: LegacyMech
    kind: ethereum/contract
    network: xdai
    source:
      abi: AgentMechLM
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/mapping.ts
      entities: [LegacyMech, Global, DailyFees]
      abis:
        - name: AgentMechLM
          file: ../../abis/AgentMech-LM.json
      eventHandlers:
        - event: Request(indexed address,uint256,bytes)
          handler: handleRequest
        - event: PriceUpdated(uint256)
          handler: handlePriceUpdateLM
      callHandlers:
        - function: exec(address,uint256,bytes,uint8,uint256)
          handler: handleExecLM

  - name: LegacyMechMarketPlace
    kind: ethereum/contract
    network: xdai
    source:
      abi: AgentMechLMM
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/mapping.ts
      entities: [LegacyMechMarketPlace, Global, DailyFees]
      abis:
        - name: AgentMechLMM
          file: ../../abis/AgentMech-LMM.json
      eventHandlers:
        - event: PriceUpdated(uint256)
          handler: handlePriceUpdateLMM
      callHandlers:
        - function: exec(address,uint256,bytes,uint8,uint256)
          handler: handleExecLMM